{{ if eq .chezmoi.os "linux" -}}
#!/bin/sh
sudo apt-get update
sudo apt-get install build-essential
sudo apt install -y zsh
sudo apt install -y fzf
sudo apt install -y tig
sudo apt install -y vim
sudo apt install curl git
git clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch v0.10.2
sudo apt install ripgrep
sudo apt install dirmngr gpg gawk
sudo apt-get -y install cmake
sudo apt install pkg-config
sudo apt-get install fontconfig

# Install rust if not installed
[ -x "$(command -v cargo)" ] || curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

{{ if eq .chezmoi.os "linux" -}}
{{   if not (.chezmoi.kernel.osrelease | lower | contains "microsoft") }}
sudo apt-get install cmake pkg-config libfreetype6-dev libfontconfig1-dev libxcb-xfixes0-dev libxkbcommon-dev python3
cargo install alacritty
cargo install docpars
{{   end }}
{{ end -}}

chsh -s $(which zsh)

#Install VS Codium
wget -qO - https://gitlab.com/paulcarroty/vscodium-deb-rpm-repo/raw/master/pub.gpg \
    | gpg --dearmor \
    | sudo dd of=/usr/share/keyrings/vscodium-archive-keyring.gpg

echo 'deb [ signed-by=/usr/share/keyrings/vscodium-archive-keyring.gpg ] https://download.vscodium.com/debs vscodium main' \
    | sudo tee /etc/apt/sources.list.d/vscodium.list

sudo apt update && sudo apt install codium

{{ else if eq .chezmoi.os "darwin" -}}
#!/bin/sh
# Accept license after an update
sudo xcodebuild -license accept

# Install brew if not installed
[ -x "$(command -v brew)" ] || /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Install rust if not installed
[ -x "$(command -v cargo)" ] || curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

cargo install alacritty
cargo install docpars

brew install ripgrep
brew install zsh

# Set as default shell
chsh -s /usr/local/bin/zsh

brew install fzf
brew install tig
brew install asdf

# To install useful key bindings and fuzzy completion:
$(brew --prefix)/opt/fzf/install

brew tap "dandavison/delta", "https://github.com/dandavison/delta"
brew tap "homebrew/cask"
brew install "asdf"
brew install "awscli"
brew install "bash"
brew install "bat"
brew install "curl"
brew install "direnv"
brew install "dog"
brew install "duf"
brew install "exa"
brew install "gnutls"
brew install "fzf"
brew install "gcc"
brew install "git"
brew install "git-delta"
brew install "git-extras"
brew install "glow"
brew install "gnu-getopt"
brew install "gnu-sed"
brew install "gnupg"
brew install "grep"
brew install "htop"
brew install "httpie"
brew install "jenv"
brew install "jq"
brew install "lsd"
brew install "make"
brew install "mas"
brew install "neovim"
brew install "rust"
brew install "starship"
brew install "the_silver_searcher"
brew install "tig"
brew install "tldr"
brew install "tmux"
brew install "tree"
brew install "vim"
brew install "wget"
brew install "gawk"
brew install --cask "font-fira-code-nerd-font"
brew install --cask "karabiner-elements"
brew install --cask "keycastr"
brew install --cask vscodium

{{ end -}}

asdf plugin add nodejs
asdf plugin add ruby https://github.com/asdf-vm/asdf-ruby.git

asdf install nodejs lts
asdf global nodejs lts

{{ if eq .chezmoi.os "linux" -}}

apt-get install autoconf bison patch build-essential rustc libssl-dev libyaml-dev libreadline6-dev zlib1g-dev libgmp-dev libncurses5-dev libffi-dev libgdbm6 libgdbm-dev libdb-dev uuid-dev

{{ else if eq .chezmoi.os "darwin" -}}

brew install openssl@3 readline libyaml gmp
export RUBY_CONFIGURE_OPTS="--with-openssl-dir=$(brew --prefix openssl@3)"
brew install rust
brew install bison

{{ end -}}

# Commented out until ruby 3.1.2 installation works in mac
# asdf install ruby latest
# asdf global ruby latest
